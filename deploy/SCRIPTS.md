# ğŸ“¦ éƒ¨ç½²æ–‡ä»¶è¯´æ˜

æœ¬ç›®å½•åŒ…å«æ‰€æœ‰æœåŠ¡å™¨éƒ¨ç½²æ‰€éœ€çš„è„šæœ¬å’Œé…ç½®æ–‡ä»¶ã€‚

## ğŸ“ æ–‡ä»¶åˆ—è¡¨

### ğŸ”§ éƒ¨ç½²è„šæœ¬

| æ–‡ä»¶ | ç”¨é€” | ä½¿ç”¨æ–¹æ³• |
|------|------|----------|
| **check.sh** | éƒ¨ç½²å‰ç¯å¢ƒæ£€æŸ¥ | `bash deploy/check.sh` |
| **server-deploy.sh** | ä¸€é”®å®Œæ•´éƒ¨ç½² | `bash deploy/server-deploy.sh` |
| **setup-ssl.sh** | é…ç½® SSL è¯ä¹¦ | `bash deploy/setup-ssl.sh your-domain.com` |
| **quick-deploy.sh** | å¿«é€Ÿæ›´æ–°ä»£ç  | `bash deploy/quick-deploy.sh` |

### âš™ï¸ é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| **nginx.conf** | Nginx åå‘ä»£ç†é…ç½® | è‡ªåŠ¨ä¸Šä¼ åˆ°æœåŠ¡å™¨ |

### ğŸ“š æ–‡æ¡£

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| **README.md** | å¿«é€Ÿéƒ¨ç½²æŒ‡å— |
| **../docs/æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md** | å®Œæ•´éƒ¨ç½²æ–‡æ¡£ |

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### åˆæ¬¡éƒ¨ç½²

```bash
# 1. æ£€æŸ¥ç¯å¢ƒ
bash deploy/check.sh

# 2. éƒ¨ç½²åˆ°æœåŠ¡å™¨
bash deploy/server-deploy.sh

# 3. é…ç½®åŸŸååï¼Œè®¾ç½® SSL
bash deploy/setup-ssl.sh your-domain.com
```

### æ—¥å¸¸æ›´æ–°

```bash
# å¿«é€Ÿæ›´æ–°ä»£ç å¹¶é‡å¯
bash deploy/quick-deploy.sh
```

---

## ğŸ” è„šæœ¬è¯¦è§£

### check.sh - ç¯å¢ƒæ£€æŸ¥

**æ£€æŸ¥é¡¹ç›®:**
- âœ… æœ¬åœ°å·¥å…· (Git, SSH, Rsync, Curl)
- âœ… æœåŠ¡å™¨è¿æ¥ (Ping, SSH)
- âœ… é¡¹ç›®æ–‡ä»¶ (docker-compose.yml, Dockerfile, web/, nginx.conf)

**è¾“å‡º:**
- é€šè¿‡: æ˜¾ç¤ºç»¿è‰² âœ“
- å¤±è´¥: æ˜¾ç¤ºçº¢è‰² âœ— å’Œè§£å†³å»ºè®®

---

### server-deploy.sh - å®Œæ•´éƒ¨ç½²

**æ‰§è¡Œæ­¥éª¤ (7æ­¥):**

1. **æ£€æŸ¥æœ¬åœ°å·¥å…·**
   - éªŒè¯ Git, SSH æ˜¯å¦å®‰è£…

2. **æµ‹è¯•æœåŠ¡å™¨è¿æ¥**
   - å°è¯• SSH è¿æ¥åˆ°æœåŠ¡å™¨

3. **å®‰è£…æœåŠ¡å™¨ä¾èµ–**
   - Docker & Docker Compose
   - Nginx
   - Certbot (SSL å·¥å…·)
   - Git

4. **åˆ›å»ºéƒ¨ç½²ç›®å½•**
   - åˆ›å»º `/opt/tdx-stock`

5. **ä¸Šä¼ é¡¹ç›®æ–‡ä»¶**
   - ä½¿ç”¨ rsync åŒæ­¥ä»£ç 
   - æ’é™¤ .git, data, *.db ç­‰æ–‡ä»¶

6. **å¯åŠ¨ Docker æœåŠ¡**
   - æ„å»ºé•œåƒ
   - å¯åŠ¨å®¹å™¨
   - å¥åº·æ£€æŸ¥

7. **é…ç½® Nginx**
   - ä¸Šä¼ é…ç½®æ–‡ä»¶
   - å¯ç”¨ç«™ç‚¹
   - é‡å¯ Nginx

**ç‰¹ç‚¹:**
- ğŸ”„ è‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿ (Ubuntu/CentOS)
- ğŸ›¡ï¸ é”™è¯¯æ—¶è‡ªåŠ¨é€€å‡º (set -e)
- ğŸ“Š å½©è‰²è¾“å‡ºï¼Œè¿›åº¦æ¸…æ™°

---

### setup-ssl.sh - SSL è¯ä¹¦é…ç½®

**æ‰§è¡Œæ­¥éª¤ (4æ­¥):**

1. **æ£€æŸ¥åŸŸåè§£æ**
   - ä½¿ç”¨ dig å‘½ä»¤éªŒè¯ DNS
   - å¯¹æ¯”è§£æ IP ä¸æœåŠ¡å™¨ IP

2. **æ›´æ–° Nginx é…ç½®**
   - æ›¿æ¢ `server_name`
   - é‡è½½ Nginx

3. **ç”³è¯· SSL è¯ä¹¦**
   - ä½¿ç”¨ Certbot + Let's Encrypt
   - è‡ªåŠ¨é…ç½® HTTPS
   - è‡ªåŠ¨è®¾ç½® HTTP é‡å®šå‘

4. **é…ç½®è‡ªåŠ¨ç»­æœŸ**
   - æµ‹è¯•ç»­æœŸæµç¨‹
   - è®¾ç½®è‡ªåŠ¨ä»»åŠ¡

**å‚æ•°:**
```bash
bash deploy/setup-ssl.sh <åŸŸå> [é‚®ç®±]
```
- `åŸŸå`: å¿…éœ€ï¼Œä½ çš„ç½‘ç«™åŸŸå
- `é‚®ç®±`: å¯é€‰ï¼Œç”¨äºè¯ä¹¦é€šçŸ¥ (é»˜è®¤: admin@åŸŸå)

**ç¤ºä¾‹:**
```bash
bash deploy/setup-ssl.sh stock.example.com
bash deploy/setup-ssl.sh stock.example.com admin@example.com
```

---

### quick-deploy.sh - å¿«é€Ÿæ›´æ–°

**æ‰§è¡Œæ­¥éª¤ (3æ­¥):**

1. **ä¸Šä¼ é¡¹ç›®æ–‡ä»¶**
   - åŒæ­¥æœ€æ–°ä»£ç åˆ°æœåŠ¡å™¨

2. **é‡å»ºå¹¶é‡å¯æœåŠ¡**
   - docker-compose down
   - docker-compose build
   - docker-compose up -d

3. **å¥åº·æ£€æŸ¥**
   - æµ‹è¯• /api/health ç«¯ç‚¹

**é€‚ç”¨åœºæ™¯:**
- ä»£ç ä¿®æ”¹åå¿«é€Ÿéƒ¨ç½²
- é…ç½®æ–‡ä»¶æ›´æ–°
- ä¸éœ€è¦é‡æ–°å®‰è£…ä¾èµ–

---

## ğŸ” æœåŠ¡å™¨é…ç½®

æ‰€æœ‰è„šæœ¬é»˜è®¤é…ç½®:

```bash
SERVER_IP="139.155.158.47"      # æœåŠ¡å™¨ IP
SERVER_USER="root"               # ç™»å½•ç”¨æˆ·
DEPLOY_DIR="/opt/tdx-stock"     # éƒ¨ç½²ç›®å½•
```

å¦‚éœ€ä¿®æ”¹ï¼Œç¼–è¾‘å„è„šæœ¬å¼€å¤´çš„é…ç½®éƒ¨åˆ†ã€‚

---

## ğŸ› æ•…éšœæ’æŸ¥

### SSH è¿æ¥å¤±è´¥

**é—®é¢˜:**
```
âœ— SSH è¿æ¥å¤±è´¥
```

**è§£å†³æ–¹æ³•:**

**æ–¹æ³• 1: é…ç½® SSH å¯†é’¥ (æ¨è)**
```bash
ssh-copy-id root@139.155.158.47
# è¾“å…¥å¯†ç : im6HZcPuFxqFf1
```

**æ–¹æ³• 2: æ‰‹åŠ¨æµ‹è¯•**
```bash
ssh root@139.155.158.47
# è¾“å…¥å¯†ç : im6HZcPuFxqFf1
```

**æ–¹æ³• 3: æ£€æŸ¥é˜²ç«å¢™**
```bash
# æµ‹è¯•ç«¯å£è¿é€šæ€§
telnet 139.155.158.47 22
```

---

### æœåŠ¡æ— æ³•å¯åŠ¨

**æŸ¥çœ‹æ—¥å¿—:**
```bash
ssh root@139.155.158.47 'cd /opt/tdx-stock && docker-compose logs'
```

**æ£€æŸ¥å®¹å™¨çŠ¶æ€:**
```bash
ssh root@139.155.158.47 'cd /opt/tdx-stock && docker-compose ps'
```

**é‡å¯æœåŠ¡:**
```bash
ssh root@139.155.158.47 'cd /opt/tdx-stock && docker-compose restart'
```

---

### SSL è¯ä¹¦ç”³è¯·å¤±è´¥

**æ£€æŸ¥åŸŸåè§£æ:**
```bash
dig +short your-domain.com
# åº”è¿”å›: 139.155.158.47
```

**æ£€æŸ¥ 80 ç«¯å£:**
```bash
curl -I http://139.155.158.47
```

**æŸ¥çœ‹ Certbot æ—¥å¿—:**
```bash
ssh root@139.155.158.47 'tail -f /var/log/letsencrypt/letsencrypt.log'
```

---

## ğŸ“ è·å–å¸®åŠ©

- ğŸ“– å®Œæ•´æ–‡æ¡£: [docs/æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md](../docs/æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md)
- ğŸ”§ é¡¹ç›®ä¸»æ–‡æ¡£: [README.md](../README.md)
- ğŸ“ API æ–‡æ¡£: [API_æ¥å£æ–‡æ¡£.md](../API_æ¥å£æ–‡æ¡£.md)

---

**Happy Deploying!** ğŸš€
