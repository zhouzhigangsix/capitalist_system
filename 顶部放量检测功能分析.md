# é¡¶éƒ¨æ”¾é‡æ£€æµ‹åŠŸèƒ½åˆ†æï¼ˆä¿®è®¢ç‰ˆï¼‰

## ä¸€ã€ä¿®è®¢åçš„æ ¸å¿ƒå®šä¹‰

### é—®é¢˜å›é¡¾

**åŸå®šä¹‰çš„ç¼ºé™·**ï¼š
```
åŸé€»è¾‘ï¼šclose > MA20 AND volume > vol_ma20 Ã— 1.5
é—®é¢˜ï¼šåªçœ‹"é«˜ä½+æ”¾é‡"ï¼Œå¿½è§†äº†å¯¹åº”çš„ä»·æ ¼åŠ¨ä½œ
åæœï¼šä¼šè¯¯æ€æ‰"é«˜ä½æ”¾é‡ä¸Šæ”»"çš„å¼ºåŠ¿è‚¡ç¥¨
```

**æ–°ç†è§£**ï¼š
- âœ… **é«˜ä½æ”¾é‡+é˜³çº¿ï¼ˆä¸Šå‡ï¼‰** = å¼ºåŠ¿è¡¨ç°ï¼Œä¿ç•™ï¼ˆä¸è¿‡æ»¤ï¼‰
- âŒ **é«˜ä½æ”¾é‡+æ»æ¶¨/é˜´çº¿ï¼ˆåœæ»/ä¸‹è·Œï¼‰** = è§é¡¶ä¿¡å·ï¼Œè¿‡æ»¤

---

## äºŒã€ä¿®è®¢åçš„å®Œæ•´å®šä¹‰

### ä¸‰ä¸ªæ¡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³

```
æ¡ä»¶1ï¼šé«˜ä½ â†’ close > MA20
  â””â”€ è‚¡ä»·åœ¨ä¸Šå‡è¶‹åŠ¿çš„é«˜ä½åŒºé—´

æ¡ä»¶2ï¼šæ”¾é‡ â†’ volume > vol_ma20 Ã— 1.5
  â””â”€ æˆäº¤é‡æ˜æ˜¾å¢åŠ 

æ¡ä»¶3ï¼šæ»æ¶¨æˆ–ä¸‹è·Œ â†’ å¯¹åº”çš„Kçº¿è¡¨ç°ä¸ä½³
  â””â”€ é˜³çº¿å¹…åº¦å°ï¼ˆç”šè‡³æ²¡æœ‰é˜³çº¿ï¼‰
  â””â”€ å‡ºç°é˜´çº¿
  â””â”€ æ—¥å†…æ³¢åŠ¨æ— åŠ›
```

### æ ¸å¿ƒæŒ‡æ ‡ï¼šKçº¿å¼ºåº¦åˆ¤æ–­

**é˜³çº¿å¼ºåº¦**çš„å®šä¹‰æ–¹å¼ï¼š

```
æ–¹å¼Aï¼šä»¥æ”¶ç›˜ä»·ç›¸å¯¹å¼€ç›˜ä»·çš„æ¶¨å¹…åˆ¤æ–­ï¼ˆæ¨èï¼‰
  â”œâ”€ strong_up = close > open AND (close - open) / open > X%
  â”œâ”€ weak_up = close > open AND (close - open) / open <= X%
  â”œâ”€ flat = close â‰ˆ openï¼ˆæ¶¨å¹…æ¥è¿‘0ï¼‰
  â””â”€ down = close < openï¼ˆé˜´çº¿ï¼‰

æ–¹å¼Bï¼šä»¥æ”¶ç›˜ä»·ç›¸å¯¹å‰æ—¥æ”¶ç›˜ä»·çš„æ¶¨å¹…åˆ¤æ–­
  â””â”€ daily_return = (close - prev_close) / prev_close
  â””â”€ åˆ¤æ–­å½“æ—¥æ¶¨å¹…æ˜¯å¦å……åˆ†

æ–¹å¼Cï¼šä»¥Kçº¿å®ä½“å¤§å°åˆ¤æ–­
  â””â”€ å®ä½“ = |close - open|
  â””â”€ å¦‚æœå®ä½“å¤ªå°ï¼Œå³ä½¿æ˜¯é˜³çº¿ä¹Ÿç®—æ»æ¶¨
```

---

## ä¸‰ã€æ¨èçš„å®ç°æ–¹æ¡ˆï¼ˆä¿®è®¢ç‰ˆï¼‰

### æ–¹æ¡ˆï¼šé«˜ä½æ”¾é‡+æ»æ¶¨è¿‡æ»¤

```python
def has_top_volume_stagnant_in_past_days(df, days=40, ma_period=20,
                                         volume_threshold=1.5,
                                         up_strength_threshold=0.01):
    """
    æ£€æŸ¥è¿‡å»40å¤©æ˜¯å¦æœ‰"é«˜ä½æ”¾é‡ä½†æ»æ¶¨"çš„ç°è±¡

    è¿‡æ»¤æ¡ä»¶ï¼ˆä¸‰ä¸ªåŒæ—¶æ»¡è¶³ï¼‰ï¼š
    1. é«˜ä½ï¼šclose > MA20
    2. æ”¾é‡ï¼švolume > vol_ma20 Ã— 1.5
    3. æ»æ¶¨/é˜´çº¿ï¼š
       - é˜³çº¿ä½†æ¶¨å¹…å°ï¼š(close - open) / open <= 1%ï¼ˆé˜ˆå€¼å¯è°ƒï¼‰
       - é˜´çº¿ï¼šclose < open
       - åå­—æ˜Ÿ/é”¤å¤´çº¿ç­‰æ— åŠ›çº¿

    è¿”å›ï¼š
        True: æ£€æµ‹åˆ°é«˜ä½æ”¾é‡+æ»æ¶¨ â†’ è¿‡æ»¤
        False: æ— æ­¤ç°è±¡ â†’ ä¿ç•™
    """
    if df is None or len(df) < ma_period + 1:
        return False

    # è®¡ç®—å‡çº¿ï¼ˆå¦‚æœè¿˜æœªè®¡ç®—ï¼‰
    if 'ma20' not in df.columns:
        df['ma20'] = df['close'].rolling(window=ma_period).mean()
    if 'vol_ma20' not in df.columns:
        df['vol_ma20'] = df['volume'].rolling(window=ma_period).mean()

    # å–è¿‡å»40å¤©çš„æ•°æ®
    start_idx = max(0, len(df) - days)
    check_df = df.iloc[start_idx:]

    # éå†æ£€æŸ¥æ˜¯å¦å‡ºç°"é«˜ä½æ”¾é‡ä½†æ»æ¶¨"
    for i in range(len(check_df)):
        row = check_df.iloc[i]

        # æ¡ä»¶1ï¼šé«˜ä½
        is_high_price = row['close'] > row['ma20']

        # æ¡ä»¶2ï¼šæ”¾é‡
        is_high_volume = row['volume'] > row['vol_ma20'] * volume_threshold

        # æ¡ä»¶3ï¼šæ»æ¶¨æˆ–é˜´çº¿
        #   â”œâ”€ é˜´çº¿ï¼šclose < open
        #   â”œâ”€ é˜³çº¿ä½†æ¶¨å¹…å°ï¼šclose > open ä¸” (close-open)/open <= threshold
        is_stagnant = (
            row['close'] < row['open'] or  # é˜´çº¿
            (row['close'] > row['open'] and
             (row['close'] - row['open']) / row['open'] < up_strength_threshold)
        )

        # ä¸‰ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³ â†’ æ£€æµ‹åˆ°å±é™©ä¿¡å·
        if is_high_price and is_high_volume and is_stagnant:
            return True

    return False
```

---

## å››ã€å‚æ•°è¯¦è§£

### å‚æ•°1ï¼šdays = 40
- æ£€æŸ¥å‘¨æœŸï¼šè¿‡å»40ä¸ªäº¤æ˜“æ—¥ï¼ˆçº¦2ä¸ªæœˆï¼‰
- ä¸è·³ç©ºæ£€æµ‹ä¿æŒä¸€è‡´
- **å¯è°ƒèŒƒå›´**ï¼š10-120å¤©

### å‚æ•°2ï¼šma_period = 20
- å‡çº¿å‘¨æœŸï¼š20æ—¥å‡çº¿
- åˆ¤æ–­"é«˜ä½"çš„å‚è€ƒçº¿
- **å¯è°ƒèŒƒå›´**ï¼š10-30å¤©
  - 10æ—¥ï¼šæ›´çµæ•
  - 20æ—¥ï¼š**æ¨è**
  - 30æ—¥ï¼šæ›´ä¿å®ˆ

### å‚æ•°3ï¼švolume_threshold = 1.5
- æ”¾é‡å€æ•°ï¼š1.5å€20æ—¥å‡é‡
- **å¯è°ƒèŒƒå›´**ï¼š1.2-2.0å€
  - 1.2å€ï¼šé«˜çµæ•åº¦ï¼ˆå®¹æ˜“è§¦å‘ï¼‰
  - 1.5å€ï¼š**æ¨è**ï¼ˆä¸­ç­‰çµæ•åº¦ï¼‰
  - 2.0å€ï¼šä½çµæ•åº¦ï¼ˆä¸¥æ ¼æ£€æµ‹ï¼‰

### å‚æ•°4ï¼šup_strength_threshold = 0.01ï¼ˆå…³é”®å‚æ•°ï¼ï¼‰
- é˜³çº¿å¼ºåº¦é˜ˆå€¼ï¼š**1%**
- å«ä¹‰ï¼šé˜³çº¿æ¶¨å¹… > 1% ç®—"æœ‰åŠ›"ï¼Œ<= 1% ç®—"æ»æ¶¨"
- **è¿™ä¸ªå‚æ•°æœ€é‡è¦**

**çµæ•åº¦å¯¹æ¯”**ï¼š

```
threshold = 0.005  (0.5%)   â†’ å¾ˆé«˜çš„çµæ•åº¦ï¼Œå®¹æ˜“è¿‡æ»¤
  â””â”€ æ¶¨å¹… > 0.5% æ‰ç®—æœ‰åŠ›
  â””â”€ é€‚åˆç‰›å¸‚ï¼ˆè¿‡æ»¤ä¸¥æ ¼ï¼‰

threshold = 0.01   (1%)    â†’ ä¸­ç­‰çµæ•åº¦ï¼Œæ¨è
  â””â”€ æ¶¨å¹… > 1% æ‰ç®—æœ‰åŠ›
  â””â”€ é€‚åˆå¸¸æ€å¸‚åœº

threshold = 0.02   (2%)    â†’ ä½çµæ•åº¦ï¼Œä¿å®ˆ
  â””â”€ æ¶¨å¹… > 2% æ‰ç®—æœ‰åŠ›
  â””â”€ åªè¿‡æ»¤æ˜æ˜¾æ»æ¶¨çš„

threshold = 0.03   (3%)    â†’ å¾ˆä½çš„çµæ•åº¦ï¼Œæä¿å®ˆ
  â””â”€ æ¶¨å¹… > 3% æ‰ç®—æœ‰åŠ›
  â””â”€ æå°‘è¿‡æ»¤
```

---

## äº”ã€æµ‹è¯•åœºæ™¯è¯¦è§£

### åœºæ™¯1ï¼šé«˜ä½æ”¾é‡+å¼ºé˜³çº¿ï¼ˆä¿ç•™ âœ…ï¼‰

```
å‰æ—¥close: 10.0
ä»Šæ—¥ï¼š
  open:   10.0
  close:  10.3        (æ¶¨å¹…3%ï¼Œstrongé˜³çº¿)
  high:   10.5
  low:    9.9
  ma20:   9.8        (10.3 > 9.8ï¼Œé«˜ä½ âœ“)
  volume: 2.5M
  vol_ma20: 900K    (2.5M > 900KÃ—1.5 = 1.35Mï¼Œæ”¾é‡ âœ“)

åˆ¤æ–­è¿‡ç¨‹ï¼š
  æ¡ä»¶1 (é«˜ä½): 10.3 > 9.8 âœ“
  æ¡ä»¶2 (æ”¾é‡): 2.5M > 1.35M âœ“
  æ¡ä»¶3 (æ»æ¶¨): (10.3-10.0)/10.0 = 3% > 1% âœ— (æ˜¯å¼ºé˜³çº¿ï¼Œä¸æ»æ¶¨)

ç»“æœï¼šä¸æ»¡è¶³å…¨éƒ¨3ä¸ªæ¡ä»¶ â†’ è¿”å›False â†’ ä¿ç•™ âœ…
```

### åœºæ™¯2ï¼šé«˜ä½æ”¾é‡+å¼±é˜³çº¿ï¼ˆè¿‡æ»¤ âŒï¼‰

```
å‰æ—¥close: 10.0
ä»Šæ—¥ï¼š
  open:   10.0
  close:  10.008      (æ¶¨å¹…0.08%ï¼Œweaké˜³çº¿)
  high:   10.05
  low:    9.95
  ma20:   9.8        (10.008 > 9.8ï¼Œé«˜ä½ âœ“)
  volume: 2.5M
  vol_ma20: 900K    (2.5M > 1.35Mï¼Œæ”¾é‡ âœ“)

åˆ¤æ–­è¿‡ç¨‹ï¼š
  æ¡ä»¶1 (é«˜ä½): 10.008 > 9.8 âœ“
  æ¡ä»¶2 (æ”¾é‡): 2.5M > 1.35M âœ“
  æ¡ä»¶3 (æ»æ¶¨): (10.008-10.0)/10.0 = 0.08% <= 1% âœ“ (å¼±é˜³çº¿ = æ»æ¶¨)

ç»“æœï¼šæ»¡è¶³å…¨éƒ¨3ä¸ªæ¡ä»¶ â†’ è¿”å›True â†’ è¿‡æ»¤ âŒ
è¯´æ˜ï¼šé«˜ä½æ”¾é‡ä½†æ¶¨å¹…æ— åŠ›ï¼Œè§é¡¶ä¿¡å·
```

### åœºæ™¯3ï¼šé«˜ä½æ”¾é‡+é˜´çº¿ï¼ˆè¿‡æ»¤ âŒï¼‰

```
å‰æ—¥close: 10.2
ä»Šæ—¥ï¼š
  open:   10.3
  close:  10.1        (è·Œå¹…1%ï¼Œé˜´çº¿)
  high:   10.4
  low:    9.95
  ma20:   9.8        (10.1 > 9.8ï¼Œé«˜ä½ âœ“)
  volume: 2.5M
  vol_ma20: 900K    (2.5M > 1.35Mï¼Œæ”¾é‡ âœ“)

åˆ¤æ–­è¿‡ç¨‹ï¼š
  æ¡ä»¶1 (é«˜ä½): 10.1 > 9.8 âœ“
  æ¡ä»¶2 (æ”¾é‡): 2.5M > 1.35M âœ“
  æ¡ä»¶3 (æ»æ¶¨): 10.1 < 10.3 âœ“ (é˜´çº¿)

ç»“æœï¼šæ»¡è¶³å…¨éƒ¨3ä¸ªæ¡ä»¶ â†’ è¿”å›True â†’ è¿‡æ»¤ âŒ
è¯´æ˜ï¼šé«˜ä½æ”¾é‡åå‡ºç°é˜´çº¿ï¼Œæ˜ç¡®è§é¡¶ä¿¡å·
```

### åœºæ™¯4ï¼šé«˜ä½æ— æ”¾é‡ï¼ˆä¿ç•™ âœ…ï¼‰

```
ma20:   9.8
close:  10.5        (é«˜ä½ âœ“)
volume: 800K
vol_ma20: 900K    (800K < 1.35Mï¼Œæ— æ”¾é‡ âœ—)

åˆ¤æ–­è¿‡ç¨‹ï¼š
  æ¡ä»¶1 (é«˜ä½): âœ“
  æ¡ä»¶2 (æ”¾é‡): âœ—
  æ¡ä»¶3 (æ»æ¶¨): -

ç»“æœï¼šä¸æ»¡è¶³å…¨éƒ¨3ä¸ªæ¡ä»¶ â†’ è¿”å›False â†’ ä¿ç•™ âœ…
è¯´æ˜ï¼šè™½ç„¶é«˜ä½ï¼Œä½†æ²¡æœ‰æ”¾é‡ï¼Œä¸æ˜¯é¡¶éƒ¨æ”¾é‡å½¢æ€
```

### åœºæ™¯5ï¼šæ”¾é‡æ— é«˜ä½ï¼ˆä¿ç•™ âœ…ï¼‰

```
close:  9.5
ma20:   10.0        (ä½ä½ âœ—)
volume: 2.5M
vol_ma20: 900K    (æ”¾é‡ âœ“)

åˆ¤æ–­è¿‡ç¨‹ï¼š
  æ¡ä»¶1 (é«˜ä½): 9.5 < 10.0 âœ—
  æ¡ä»¶2 (æ”¾é‡): âœ“
  æ¡ä»¶3 (æ»æ¶¨): -

ç»“æœï¼šä¸æ»¡è¶³å…¨éƒ¨3ä¸ªæ¡ä»¶ â†’ è¿”å›False â†’ ä¿ç•™ âœ…
è¯´æ˜ï¼šä½ä½æ”¾é‡ï¼ˆä¹°ç›˜ï¼‰ï¼Œä¸æ˜¯é¡¶éƒ¨ç°è±¡
```

### åœºæ™¯6ï¼šé«˜ä½æ”¾é‡+åå­—æ˜Ÿï¼ˆè¿‡æ»¤ âŒï¼‰

```
å‰æ—¥close: 10.2
ä»Šæ—¥ï¼š
  open:   10.1
  close:  10.1        (åå­—æ˜Ÿï¼Œopen â‰ˆ close)
  high:   10.3
  low:    9.9
  ma20:   9.8        (é«˜ä½ âœ“)
  volume: 2.5M       (æ”¾é‡ âœ“)

åˆ¤æ–­è¿‡ç¨‹ï¼š
  æ¡ä»¶3 (æ»æ¶¨): (10.1-10.1)/10.1 = 0% <= 1% âœ“ (æ˜¯æ»æ¶¨)

ç»“æœï¼šæ»¡è¶³å…¨éƒ¨3ä¸ªæ¡ä»¶ â†’ è¿”å›True â†’ è¿‡æ»¤ âŒ
è¯´æ˜ï¼šåå­—æ˜Ÿæ˜¾ç¤ºå¤šç©ºå¹³è¡¡ï¼Œç»“åˆæ”¾é‡ä¸ºè§é¡¶ä¿¡å·
```

---

## å…­ã€å…³é”®å†³ç­–ï¼šé˜³çº¿å¼ºåº¦é˜ˆå€¼

### é€‰æ‹©å»ºè®®

**é—®é¢˜**ï¼šç”¨ä»€ä¹ˆæ•°å€¼åšä¸º"æœ‰åŠ›é˜³çº¿"çš„ç•Œé™ï¼Ÿ

**é€‰é¡¹å¯¹æ¯”**ï¼š

| é˜ˆå€¼ | å«ä¹‰ | è¿‡æ»¤åŠ›åº¦ | é€‚åº”æƒ…å†µ |
|------|------|---------|---------|
| 0.5% | æ¶¨å¹…>0.5% | å¾ˆå¼º | ç‰›å¸‚ç¯å¢ƒ |
| **1.0%** | æ¶¨å¹…>1% | ä¸­ç­‰ | **å¸¸æ€æ¨è** |
| 1.5% | æ¶¨å¹…>1.5% | ä¸­ç­‰ | æ­£å¸¸è¡Œæƒ… |
| 2.0% | æ¶¨å¹…>2% | è¾ƒå¼± | ç†Šå¸‚ç¯ä¿ |
| 3.0% | æ¶¨å¹…>3% | å¾ˆå¼± | æä¿å®ˆ |

**æ¨è**ï¼š**1.0%** (0.01)
- ä¸ä¼šè¯¯æ€çœŸæ­£çš„å¼ºåŠ¿è‚¡ï¼ˆé˜³çº¿>1%å¾ˆæ™®éï¼‰
- èƒ½æ•æ‰ç¡®å®æ»æ¶¨çš„ç°è±¡ï¼ˆ0-1%æ¶¨å¹…å¾ˆå¯ç–‘ï¼‰
- ä¸å¸‚åœºå¸¸è§æ³¢åŠ¨èŒƒå›´åŒ¹é…

**æ›¿ä»£é€‰æ‹©**ï¼š
- ä¿å®ˆå‹äº¤æ˜“è€…ï¼š2.0% (0.02)
- æ¿€è¿›å‹äº¤æ˜“è€…ï¼š0.5% (0.005)

---

## ä¸ƒã€ä¸è·³ç©ºæ£€æµ‹çš„äº’è¡¥

### ä¸¤ä¸ªæ¡ä»¶çš„é£é™©è¦†ç›–

| æ£€æµ‹æ¡ä»¶ | é£é™©ç±»å‹ | è§¦å‘å½¢æ€ |
|---------|---------|---------|
| **è·³ç©ºæ£€æµ‹** | ä»·æ ¼æ–­å±‚é£é™© | å¸‚åœºç¼ºå£ã€çªå‘äº‹ä»¶ |
| **é¡¶éƒ¨æ”¾é‡æ»æ¶¨** | è§é¡¶è¡°ç«­é£é™© | å¤šå¤´åŠ›é‡æ¯ç«­ |

**ç»„åˆæ•ˆæœ**ï¼š
```
åŸ5ä¸ªæ¡ä»¶         â†’ 100åª
+ è·³ç©ºæ£€æµ‹        â†’ 80åªï¼ˆè¿‡æ»¤20åªç¼ºå£è‚¡ï¼‰
+ é¡¶éƒ¨æ»æ¶¨æ£€æµ‹    â†’ 60åªï¼ˆå†è¿‡æ»¤20åªé¡¶éƒ¨è§é¡¶è‚¡ï¼‰

æœ€ç»ˆé€‰è‚¡ï¼š
  âœ“ é¿å…ç¼ºå£é£é™©
  âœ“ é¿å…é¡¶éƒ¨è§é¡¶
  âœ“ åªä¿ç•™å¥åº·ä¸Šå‡çš„è‚¡ç¥¨
```

---

## å…«ã€ä»£ç æ•°æ®æµ

### éœ€è¦çš„æ•°æ®

| æ•°æ® | æ¥æº | çŠ¶æ€ |
|------|------|------|
| close | Kçº¿æ•°æ® | âœ… å·²æœ‰ |
| open | Kçº¿æ•°æ® | âœ… å·²æœ‰ |
| volume | Kçº¿æ•°æ® | âœ… å·²æœ‰ |
| ma20 | calculate_indicators() | âœ… å·²è®¡ç®— |
| vol_ma20 | calculate_indicators() | âœ… å·²è®¡ç®— |

**æ— éœ€é¢å¤–è·å–æ•°æ®ï¼**

### è®¡ç®—è¿‡ç¨‹

```
å¯¹äºæ¯åªè‚¡ç¥¨çš„æ¯ä¸€è¡Œæ•°æ®ï¼š

1. æ£€æŸ¥æ¡ä»¶1 (é«˜ä½åˆ¤æ–­)
   is_high = close > ma20

2. æ£€æŸ¥æ¡ä»¶2 (æ”¾é‡åˆ¤æ–­)
   is_volume = volume > vol_ma20 * 1.5

3. æ£€æŸ¥æ¡ä»¶3 (æ»æ¶¨åˆ¤æ–­)
   is_stagnant = (close < open) OR  # é˜´çº¿
                 ((close > open) AND (close-open)/open <= 0.01)

4. ç»¼åˆåˆ¤æ–­
   if is_high AND is_volume AND is_stagnant:
       return True  # è¿‡æ»¤

5. éå†å®Œ40å¤©å
   return False  # ä¿ç•™
```

---

## ä¹ã€æ€§èƒ½è¯„ä¼°

### æ—¶é—´å¤æ‚åº¦

```
å•è‚¡æ£€æŸ¥ï¼š
  éå†40è¡Œ Ã— 3ä¸ªæ¡ä»¶æ£€æŸ¥ + ç®€å•ç®—æœ¯
  â†’ O(40) = O(1)
  â†’ < 1ms/è‚¡

å…¨å¸‚åœºï¼š
  5462è‚¡ Ã— 1ms = ~5ç§’
  ï¼ˆåœ¨æ€»æµç¨‹3-5åˆ†é’Ÿä¸­å æ¯” < 2%ï¼‰
```

### ç©ºé—´å¤æ‚åº¦

```
ä»…åˆ›å»ºcheck_dfè§†å›¾ï¼Œæ— é¢å¤–å†…å­˜å ç”¨
O(1)ç©ºé—´
```

---

## åã€å¯èƒ½çš„ä¼˜åŒ–æ–¹å‘

### ä¼˜åŒ–1ï¼šç»“åˆæ¶¨è·Œå¹… + æˆäº¤é‡å¼‚å¸¸

```python
# ä¸ä»…çœ‹ç»å¯¹æ¶¨å¹…ï¼Œè¿˜çœ‹æ˜¯å¦è·Œç ´å‡çº¿
is_stagnant = (
    row['close'] < row['open'] or
    row['close'] < row['ma20'] or  # æ–°å¢ï¼šè·Œç ´å‡çº¿
    (row['close'] > row['open'] and
     (row['close'] - row['open']) / row['open'] <= threshold)
)
```

### ä¼˜åŒ–2ï¼šè¯†åˆ«ä¸Šå½±çº¿ï¼ˆå¤´éƒ¨è¯•æ¢ï¼‰

```python
# è¯†åˆ«"ä¸Šå½±çº¿é•¿"çš„Kçº¿ï¼ˆè¯•æ¢æ€§ä¸Šæ”»åå›è½ï¼‰
upper_shadow = (row['high'] - row['close']) / (row['high'] - row['low'])
is_stagnant = upper_shadow > 0.5  # ä¸Šå½±çº¿è¶…è¿‡50%
```

### ä¼˜åŒ–3ï¼š3æ—¥ç»„åˆåˆ¤æ–­

```python
# åˆ¤æ–­3æ—¥å†…æ˜¯å¦æœ‰"é«˜ä½æ”¾é‡+ä¸‹è·Œ"çš„ç»„åˆ
# è¿™æ ·å¯ä»¥æ•æ‰"è¿ç»­æ»æ¶¨"ç°è±¡
```

---

## åä¸€ã€æœ€ç»ˆå»ºè®®æ€»ç»“

### âœ… æ¨èæ–¹æ¡ˆï¼ˆå·²ä¿®è®¢ï¼‰

```python
def has_top_volume_stagnant_in_past_days(df, days=40, ma_period=20,
                                         volume_threshold=1.5,
                                         up_strength_threshold=0.01):
    """
    æ£€æŸ¥é«˜ä½æ”¾é‡ä½†æ»æ¶¨çš„ç°è±¡

    ä¸‰ä¸ªæ¡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³ï¼š
    1. é«˜ä½: close > MA20
    2. æ”¾é‡: volume > vol_ma20 Ã— 1.5
    3. æ»æ¶¨:
       - é˜´çº¿: close < open
       - å¼±é˜³çº¿: 0 < (close-open)/open <= 1%
    """
```

### å‚æ•°è®¾å®š

```python
# æ¨èé…ç½®
days = 40              # ä¸è·³ç©ºæ£€æµ‹ä¸€è‡´
ma_period = 20         # æ ‡å‡†å‡çº¿å‘¨æœŸ
volume_threshold = 1.5 # 1.5å€æ”¾é‡
up_strength_threshold = 0.01  # 1%æ¶¨å¹…ç•Œé™ï¼ˆå…³é”®å‚æ•°ï¼‰
```

### ä¸‰å±‚é˜²å®ˆä½“ç³»

```
åŸ5ä¸ªæ¡ä»¶           â†’ åŸºç¡€è¿‡æ»¤ï¼ˆæŠ€æœ¯æŒ‡æ ‡ï¼‰
+ è·³ç©ºæ£€æµ‹(cond6)   â†’ é£é™©è¿‡æ»¤1ï¼ˆä»·æ ¼è¿ç»­æ€§ï¼‰
+ é¡¶éƒ¨æ»æ¶¨(cond7)   â†’ é£é™©è¿‡æ»¤2ï¼ˆé‡ä»·èƒŒç¦»ï¼‰

æœ€ç»ˆé€‰è‚¡ = 7ä¸ªæ¡ä»¶å…¨éƒ¨æ»¡è¶³çš„è‚¡ç¥¨
```

---

## åäºŒã€ç”¨æˆ·å†³ç­–æ¸…å•

**éœ€è¦ä½ ç¡®è®¤çš„äº‹é¡¹**ï¼š

```
Q1: åŒæ„"é«˜ä½æ”¾é‡+æ»æ¶¨"çš„ä¸‰æ¡ä»¶å®šä¹‰å—ï¼Ÿ
    â””â”€ æ˜¯ â†’ ç»§ç»­
    â””â”€ å¦ â†’ è°ƒæ•´å“ªä¸ªæ¡ä»¶ï¼Ÿ

Q2: é˜³çº¿å¼ºåº¦é˜ˆå€¼ç”¨1%åˆé€‚å—ï¼Ÿ
    â””â”€ 1.0% (0.01)   â†’ æ¨è
    â””â”€ 0.5% (0.005)  â†’ æ›´æ¿€è¿›
    â””â”€ 1.5% (0.015)  â†’ æ›´ä¿å®ˆ
    â””â”€ 2.0% (0.02)   â†’ æœ€ä¿å®ˆ

Q3: æ˜¯å¦éœ€è¦è€ƒè™‘å…¶ä»–å› ç´ ï¼Ÿ(å¦‚ä¸Šå½±çº¿ã€è¿ç»­æ»æ¶¨ç­‰)
    â””â”€ ä¸éœ€è¦ â†’ ç®€å•ç‰ˆæœ¬
    â””â”€ éœ€è¦ â†’ é«˜çº§ç‰ˆæœ¬

Q4: å…¶ä»–å‚æ•°(days=40, ma=20, vol_å€æ•°=1.5)å¯ä»¥å—ï¼Ÿ
    â””â”€ å¯ä»¥ â†’ å¼€å§‹ç¼–ç 
    â””â”€ éœ€è¦è°ƒæ•´ â†’ è¯´æ˜è°ƒæ•´æ–¹æ¡ˆ
```

---

**ä¿®è®¢ç‰ˆåˆ†æå®Œæˆï¼Œç­‰å¾…ä½ çš„ review** ğŸ‘ˆ

