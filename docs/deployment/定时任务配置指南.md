# ğŸ• å®šæ—¶ä»»åŠ¡é…ç½®æŒ‡å—

## ğŸ“‹ è‡ªåŠ¨é€‰è‚¡å®šæ—¶ä»»åŠ¡

æ¯ä¸ªäº¤æ˜“æ—¥ä¸‹åˆ **15:13** è‡ªåŠ¨æ‰§è¡Œ B1 é€‰è‚¡ç­–ç•¥ã€‚

---

## âš™ï¸ é…ç½®æ­¥éª¤

### æ­¥éª¤ 1: ä¸Šä¼ è„šæœ¬åˆ°æœåŠ¡å™¨

è„šæœ¬å·²åŒ…å«åœ¨é¡¹ç›®ä¸­ï¼š`scripts/run_strategy_cron.sh`

### æ­¥éª¤ 2: å®‰è£… Python ä¾èµ–

```bash
ssh root@139.155.158.47

# å®‰è£… Python3 å’Œ pip
yum install -y python3 python3-pip

# å®‰è£…ä¾èµ–åº“
pip3 install requests pandas numpy
```

### æ­¥éª¤ 3: é…ç½®å®šæ—¶ä»»åŠ¡

```bash
ssh root@139.155.158.47

# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ¯å¤© 15:13 æ‰§è¡Œï¼‰
13 15 * * * /opt/tdx-stock/scripts/run_strategy_cron.sh

# ä¿å­˜é€€å‡ºï¼ˆviç¼–è¾‘å™¨ï¼šæŒ‰ Escï¼Œè¾“å…¥ :wqï¼Œå›è½¦ï¼‰
```

### æ­¥éª¤ 4: éªŒè¯å®šæ—¶ä»»åŠ¡

```bash
# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡åˆ—è¡¨
crontab -l

# åº”è¯¥æ˜¾ç¤º:
# 13 15 * * * /opt/tdx-stock/scripts/run_strategy_cron.sh
```

---

## ğŸ“Š Crontab æ—¶é—´æ ¼å¼è¯´æ˜

```
åˆ†é’Ÿ å°æ—¶ æ—¥æœŸ æœˆä»½ æ˜ŸæœŸ å‘½ä»¤

13   15   *    *    *    /opt/tdx-stock/scripts/run_strategy_cron.sh
â”‚    â”‚    â”‚    â”‚    â”‚
â”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€ æ˜ŸæœŸå‡  (0-7, 0å’Œ7éƒ½æ˜¯å‘¨æ—¥)
â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€ æœˆä»½ (1-12)
â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¥æœŸ (1-31)
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0-59)
```

### å¸¸ç”¨å®šæ—¶ä»»åŠ¡ç¤ºä¾‹

| æ—¶é—´ | Cron è¡¨è¾¾å¼ | è¯´æ˜ |
|------|------------|------|
| æ¯å¤© 15:13 | `13 15 * * *` | æ”¶ç›˜åæ‰§è¡Œ |
| æ¯å¤© 9:30 | `30 9 * * *` | å¼€ç›˜æ—¶æ‰§è¡Œ |
| æ¯å¤© 12:00 | `0 12 * * *` | ä¸­åˆæ‰§è¡Œ |
| å·¥ä½œæ—¥ 15:13 | `13 15 * * 1-5` | å‘¨ä¸€åˆ°å‘¨äº” |
| æ¯å°æ—¶æ‰§è¡Œ | `0 * * * *` | æ¯å°æ—¶æ•´ç‚¹ |

---

## ğŸ“ æ—¥å¿—ç®¡ç†

### æ—¥å¿—ä½ç½®

```
/var/log/tdx-stock/strategy_YYYYMMDD.log
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
tail -f /var/log/tdx-stock/strategy_$(date +%Y%m%d).log

# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
ls -lt /var/log/tdx-stock/ | head -5
tail -100 /var/log/tdx-stock/strategy_*.log | tail -50
```

### æ—¥å¿—è‡ªåŠ¨æ¸…ç†

è„šæœ¬ä¼šè‡ªåŠ¨åˆ é™¤ **7 å¤©å‰**çš„æ—§æ—¥å¿—ï¼Œä¿æŒç£ç›˜ç©ºé—´ã€‚

---

## ğŸ”§ æ‰‹åŠ¨æ‰§è¡Œæµ‹è¯•

### æµ‹è¯•å®šæ—¶ä»»åŠ¡è„šæœ¬

```bash
ssh root@139.155.158.47

# æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬
bash /opt/tdx-stock/scripts/run_strategy_cron.sh

# æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—
tail -f /var/log/tdx-stock/strategy_$(date +%Y%m%d).log
```

### ç›´æ¥æµ‹è¯•ç­–ç•¥è„šæœ¬

```bash
ssh root@139.155.158.47
cd /opt/tdx-stock

# ç›´æ¥è¿è¡Œç­–ç•¥
python3 strategy_b1.py
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ—¶åŒºè®¾ç½®

ç¡®ä¿æœåŠ¡å™¨æ—¶åŒºæ­£ç¡®ï¼š
```bash
# æŸ¥çœ‹å½“å‰æ—¶åŒº
timedatectl

# å¦‚æœä¸æ˜¯ Asia/Shanghaiï¼Œè®¾ç½®æ—¶åŒº
timedatectl set-timezone Asia/Shanghai
```

### 2. æƒé™è®¾ç½®

ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼š
```bash
chmod +x /opt/tdx-stock/scripts/run_strategy_cron.sh
```

### 3. ç¯å¢ƒå˜é‡

cron ç¯å¢ƒå˜é‡å¯èƒ½ä¸å®Œæ•´ï¼Œè„šæœ¬ä¸­å·²è®¾ç½®ï¼š
```bash
export PATH=/usr/local/bin:/usr/bin:/bin
```

### 4. æ£€æŸ¥ cron æœåŠ¡

```bash
# æ£€æŸ¥ crond æœåŠ¡çŠ¶æ€
systemctl status crond

# å¦‚æœæœªå¯åŠ¨ï¼Œå¯åŠ¨æœåŠ¡
systemctl start crond
systemctl enable crond
```

---

## ğŸ“Š ç›‘æ§å’Œå‘Šè­¦

### æ£€æŸ¥ä»»åŠ¡æ‰§è¡Œæƒ…å†µ

```bash
# æŸ¥çœ‹ cron æ—¥å¿—
tail -f /var/log/cron

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# Dec  1 15:13:01 VM-0-15-centos CROND[12345]: (root) CMD (/opt/tdx-stock/scripts/run_strategy_cron.sh)
```

### æ£€æŸ¥ç­–ç•¥æ‰§è¡Œç»“æœ

```bash
# æŸ¥çœ‹æœ€æ–°é€‰è‚¡ç»“æœ
ssh root@139.155.158.47 'cd /opt/tdx-stock && sqlite3 stocks.db "SELECT code, price, score FROM strategy_results WHERE date = strftime(\"%Y-%m-%d\", \"now\") ORDER BY score DESC LIMIT 10;"'
```

### è®¾ç½®é‚®ä»¶å‘Šè­¦ï¼ˆå¯é€‰ï¼‰

```bash
# å®‰è£… mailx
yum install -y mailx

# ä¿®æ”¹ crontab æ·»åŠ é‚®ä»¶æ¥æ”¶
MAILTO=your-email@example.com
13 15 * * * /opt/tdx-stock/scripts/run_strategy_cron.sh
```

---

## ğŸ”„ æ›´æ–°ç­–ç•¥

å½“ä½ ä¿®æ”¹äº†ç­–ç•¥ä»£ç åï¼š

```bash
# æ–¹æ³•1: ä½¿ç”¨å¿«é€Ÿéƒ¨ç½²è„šæœ¬
bash deploy/quick-deploy.sh

# æ–¹æ³•2: æ‰‹åŠ¨åŒæ­¥
rsync -avz strategy_b1.py root@139.155.158.47:/opt/tdx-stock/
```

**æ— éœ€é‡å¯ cron**ï¼Œä¸‹æ¬¡å®šæ—¶ä»»åŠ¡ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°ä»£ç ã€‚

---

## ğŸ“… å®šæ—¶ä»»åŠ¡ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡
crontab -l

# ç¼–è¾‘å®šæ—¶ä»»åŠ¡
crontab -e

# åˆ é™¤æ‰€æœ‰å®šæ—¶ä»»åŠ¡
crontab -r

# ä¸´æ—¶ç¦ç”¨å®šæ—¶ä»»åŠ¡ï¼ˆæ³¨é‡Šæ‰ï¼‰
crontab -e
# åœ¨ä»»åŠ¡å‰åŠ  #
# # 13 15 * * * /opt/tdx-stock/scripts/run_strategy_cron.sh
```

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### é—®é¢˜1: å®šæ—¶ä»»åŠ¡æœªæ‰§è¡Œ

**æ£€æŸ¥ï¼š**
```bash
# 1. æŸ¥çœ‹ cron æ—¥å¿—
tail -f /var/log/cron

# 2. æ£€æŸ¥ crond æœåŠ¡
systemctl status crond

# 3. æ£€æŸ¥è„šæœ¬æƒé™
ls -l /opt/tdx-stock/scripts/run_strategy_cron.sh
```

### é—®é¢˜2: è„šæœ¬æ‰§è¡Œå¤±è´¥

**æ£€æŸ¥ï¼š**
```bash
# æŸ¥çœ‹ç­–ç•¥æ—¥å¿—
tail -100 /var/log/tdx-stock/strategy_$(date +%Y%m%d).log

# æ‰‹åŠ¨æ‰§è¡Œæµ‹è¯•
bash -x /opt/tdx-stock/scripts/run_strategy_cron.sh
```

### é—®é¢˜3: Python æ¨¡å—æ‰¾ä¸åˆ°

**è§£å†³ï¼š**
```bash
# ç¡®è®¤ pip3 å®‰è£…ä½ç½®
which pip3

# é‡æ–°å®‰è£…ä¾èµ–
pip3 install --upgrade requests pandas numpy
```

---

**é…ç½®å®Œæˆåï¼Œç³»ç»Ÿå°†æ¯å¤©ä¸‹åˆ 15:13 è‡ªåŠ¨æ‰§è¡Œé€‰è‚¡ç­–ç•¥ï¼** ğŸ‰
