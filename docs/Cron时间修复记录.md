# Cron 时间修复记录

## 问题发现

**时间**：2025-12-03 14:22:14 CST（北京时间）
**发现者**：用户反馈
**问题描述**：配置的 Cron 任务实际执行时间与预期不符

### 原始配置
```bash
8 10 * * 1-5 /opt/tdx-stock/scripts/run_strategy_cron.sh
```
- **实际执行时间**：每天 **10:08 CST**（上午 10 点）
- **预期执行时间**：每天 **22:08 CST**（晚上 10 点过 8 分）

### 服务器时区确认
```
Time zone: Asia/Shanghai (CST, +0800)
Current time: Wed Dec 3 14:22:14 CST 2025
```

---

## 修复方案

### 修复内容
将 Cron 任务时间从 `8 10` 改为 `8 22`

### 修复前
```bash
8 10 * * 1-5 /opt/tdx-stock/scripts/run_strategy_cron.sh
```

### 修复后
```bash
8 22 * * 1-5 /opt/tdx-stock/scripts/run_strategy_cron.sh
```

### 执行命令
```bash
crontab -l | sed 's/8 10 \* \* 1-5/8 22 * * 1-5/' | crontab -
```

### 修复验证
```bash
✅ Cron 已更新为晚上 22:08
8 22 * * 1-5 /opt/tdx-stock/scripts/run_strategy_cron.sh
```

---

## 修复影响

### 受影响的文件
1. **自动化流程说明.md** - 已更新
   - 修改：核心时间点从 `8 10 * * 1-5` 改为 `8 22 * * 1-5`
   - 修改：标题从 "每日 20:08" 改为 "每日 22:08"
   - 新增：时区说明

2. **时序图和流程详解.md** - 已更新
   - 修改：Cron Job 触发说明
   - 修改：标题从 "每日 20:08 执行时序" 改为 "每日 22:08 执行时序"
   - 新增：时区信息

### 功能验证
- ✅ Cron 任务已更新为晚上 22:08 执行
- ✅ 时区确认为 Asia/Shanghai (CST, +0800)
- ✅ 每日自动化流程将在正确时间触发

---

## 后续说明

从 2025-12-03 起，系统将在每个交易日晚上 **22:08**（10 点过 8 分）自动执行：
1. **选股流程**：运行 B1 策略，扫描全市场股票
2. **保存选股**：将当日选股结果保存到数据库
3. **回测计算**：自动计算前一日选股的今日收益
4. **保存回测**：将回测结果保存到数据库

用户无需手动操作，系统完全自动化运行。

---

## Cron 表达式说明

### 新配置
```
8 22 * * 1-5
│ │  │ │ └─── 星期：1-5（周一到周五，仅交易日）
│ │  │ └────── 月份：*（每月）
│ │  └───────── 日期：*（每天）
│ └──────────── 小时：22（晚上 10 点）
└───────────── 分钟：8
```

**执行时间**：每个交易日晚上 22:08 CST（北京时间 10 点过 8 分）

---

## 修复时间戳

- 发现时间：2025-12-03 14:22:14 CST
- 修复时间：2025-12-03 14:23:XX CST
- 验证时间：修复即时验证成功
